# 課題リポジトリの使い方: 実践編

> [!NOTE]  
> 初回は、Codespaces を使用して課題を受け取り、実施と提出のフローを簡単に体験しました。  
> 実践編では、初回の課題実施・提出フローをおさらいすることで、自主的にコードのテスト-修正-コミットの流れが出来るようにします。

## この課題で学ぶこと（目的・到達目標）
- **課題の実施から提出まで**の一連の流れを定着させる。
- コードの変更に失敗したとき、**コミット地点から再開する手順**を体験する。

---

## 課題の全体像 (おさらい)
1. 招待リンクから課題を受け取る
2. Codespaces で開く
3. **README を読む（この文書）**
4. `src/kadai` 配下の課題ファイルに**実装**する
5. **テスト**を実行して確認する（`./scripts/test N` または `pytest` または フラスコマークからテスト）
6. **コミット**（変更を記録）して、次の段階へ進む
7. **提出**（サイドバー → ソース管理 → **変更を同期**）

> [!TIP]  
> 基本は「**実装 → テスト → コミット**」の繰り返しです。  
> コードを修正しすぎて前段階のテストに通らなくなってしまった場合に備え、目の前のテストに通ったらコミットを徹底しましょう！

---

## 実践 (ステージ1～4)
> 課題: **簡単な四則演算をするプログラムを作ろう**

-  **機能一覧**... `calc.py`
    * `add`: 足し算をする関数。`add(5, 8) -> 13`
    * `sub`: 引き算をする関数。`sub(11, 3) -> 8`
    * `mul`: 掛け算をする関数。`mul(4, 6) -> 24`
    * `div`: 割り算をする関数。`div(7, 2) -> 3.5`　

---

- ここからの手順を確認しながら進めるために、**README.md のプレビューを画面右にドラッグし2画面で進行**することをおすすめします。
- 実際に採点して成績に反映する課題は、以下のようにステージ毎の点数を割り振っています。  
  今回はまだ成績への反映は行いません。

### **ステージ1**: add 関数実装(25点)
1. `tests/stages/stage-01/test_add.py` は、`add` がどんな関数であってほしいかを表すテストです。  
   `assert` 文を確認してみましょう。
   ```python
   assert add(5, 8) == 13 # 5 + 8 = 13 を返すようにしよう
   ```

2. テストに通るように、`src/kadai/calc.py` に、`add` 関数を実装します。
3. ステージ1 のテストをして、`add` 関数がテストに通るよう実装されているか確認しましょう。  
   ターミナルから実行する場合:
   ```bash
   ./scripts/test 1
   ```
   ```bash
   pytest
   ```

> [!TIP]  
> 今回は提出手順の復習のため、簡単なテストに通ったらこのまま次に進みます。  
> 実際には、`return 13` のような処理でテストに通ってしまうので、リファクタリングで修正したり、  
> より多くの段階のテストで検証を行います。

4. テストに通ったら、コミットします。  
   **ソース管理 → 変更**にカーソル → **すべての変更をステージ** → **コミットメッセージを記入** → **コミット**

---

### **ステージ2**: sub 関数実装(25点)
1. `tests/stages/stage-02/test_sub.py` は、`sub` がどんな関数であってほしいかを表すテストです。  
   `assert` 文を確認してみましょう。
   ```python
   assert sub(11, 3) == 8 # 11 - 3 = 8 を返すようにしよう
   ```

2. テストに通るように、`src/kadai/calc.py` に、`sub` 関数を実装します。
3. 関数を新たに追加したことを教えてあげなければいけません。`src/kadai/__init__.py` の後ろに `, sub` と付け足します。

   ```python
   from .calc import add, sub
   ```

4. ステージ2 のテストをして、`sub` 関数がテストに通るよう実装されているか確認しましょう。  
   - ターミナルから実行する場合:
     ```bash
     ./scripts/test 2
     ```
     ```bash
     pytest
     ```

   - 画面左メニューのフラスコアイコン「テスト」から実行する場合:  
     **Configure Python Tests** → pytest を選択 → tests フォルダを選択

5. テストに通ったら、コミットします。  
   **ソース管理 → 変更**にカーソル → **すべての変更をステージ** → **コミットメッセージを記入** → **コミット**

---

### **ステージ3**: mul 関数実装(25点)
- **ステージ2** と同じように、**テストを見る** → 関数追加 → テスト の順で実装してみましょう！  
  `__init__.py` に関数を追加したことを教えてあげるのを忘れずに。

   ```python
   from .calc import add, sub, mul
   ```

---

### **ステージ4**: div 関数実装(25点)

- 同様に、**テストを見る** → 関数追加 → テスト の順で実装してみましょう！  
  `__init__.py` に関数を追加したことを教えてあげるのを忘れずに。

   ```python
   from .calc import add, sub, mul, div
   ```

> [!TIP]  
> 実は、このままのテストでは `div` 関数で重大なバグが発生する余地があります。  
> 余裕があれば、`div` 関数のバグを防ぐ構成やそのテスト方法について考えてみましょう！

---

## トラブルシューティング

- **`ModuleNotFoundError` が出る**：  
  `src/kadai/__init__.py` に関数名を追加しているか確認してみましょう。

- **前段階のテストに通らなくなった**:  
  復旧が難しければ、以下の手順でひとつ前のコミットに戻しましょう。

  1) **ソース管理 → 変更（の上）** にカーソル  
  2) 右側の「…」→ **前回のコミットを元に戻す**  
  3) 「…」→ 変更 → **すべての変更のステージング解除**  
  4) 「…」→ 変更 → **すべての変更の破棄**